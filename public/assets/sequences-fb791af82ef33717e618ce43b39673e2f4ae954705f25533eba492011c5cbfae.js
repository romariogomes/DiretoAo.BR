$(document).ready(function(){function t(t){r(),l(),d3.select("#togglelegend").on("click",s),v.append("svg:circle").attr("r",u).style("opacity",0);var a=d3.hierarchy(t).sum(function(t){return t.size}).sort(function(t,e){return e.value-t.value}),i=y(a).descendants().filter(function(t){return t.x1-t.x0>.005}),d=v.data([t]).selectAll("path").data(i).enter().append("svg:path").attr("display",function(t){return t.depth?null:"none"}).attr("d",g).attr("fill-rule","evenodd").style("fill",function(t){return p[t.data.name]}).style("opacity",1).on("mouseover",e);d3.select("#container").on("mouseleave",n),f=d.datum().value}function e(t){var e=(100*t.value/f).toPrecision(3),n=e+"%";e<.1&&(n="< 0.1%"),d3.select("#percentage").text(n),d3.select("#explanation").style("visibility","");var r=t.ancestors().reverse();r.shift(),i(r,n),d3.selectAll("path").style("opacity",.3),v.selectAll("path").filter(function(t){return r.indexOf(t)>=0}).style("opacity",1)}function n(){d3.select("#trail").style("visibility","hidden"),d3.selectAll("path").on("mouseover",null),d3.selectAll("path").transition().duration(1e3).style("opacity",1).on("end",function(){d3.select(this).on("mouseover",e)}),d3.select("#explanation").style("visibility","hidden")}function r(){d3.select("#sequence").append("svg:svg").attr("width",o).attr("height",50).attr("id","trail").append("svg:text").attr("id","endlabel").style("fill","#000")}function a(t,e){var n=[];return n.push("0,0"),n.push(h.w+",0"),n.push(h.w+h.t+","+h.h/2),n.push(h.w+","+h.h),n.push("0,"+h.h),e>0&&n.push(h.t+","+h.h/2),n.join(" ")}function i(t,e){var n=d3.select("#trail").selectAll("g").data(t,function(t){return t.data.name+t.depth});n.exit().remove();var r=n.enter().append("svg:g");r.append("svg:polygon").attr("points",a).style("fill",function(t){return p[t.data.name]}),r.append("svg:text").attr("x",(h.w+h.t)/2).attr("y",h.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.data.name}),r.merge(n).attr("transform",function(t,e){return"translate("+e*(h.w+h.s)+", 0)"}),d3.select("#trail").select("#endlabel").attr("x",(t.length+.5)*(h.w+h.s)).attr("y",h.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(e),d3.select("#trail").style("visibility","")}function l(){var t={w:130,h:30,s:3,r:3},e=d3.select("#legend").append("svg:svg").attr("width",t.w).attr("height",d3.keys(p).length*(t.h+t.s)),n=e.selectAll("g").data(d3.entries(p)).enter().append("svg:g").attr("transform",function(e,n){return"translate(0,"+n*(t.h+t.s)+")"});n.append("svg:rect").attr("rx",t.r).attr("ry",t.r).attr("width",t.w).attr("height",t.h).style("fill",function(t){return t.value}),n.append("svg:text").attr("x",t.w/2).attr("y",t.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.key})}function s(){var t=d3.select("#legend");"hidden"==t.style("visibility")?t.style("visibility",""):t.style("visibility","hidden")}function d(t){for(var e={name:"root",children:[]},n=0;n<t.length;n++){var r=t[n][0],a=+t[n][1];if(!isNaN(a))for(var i=r.split("-"),l=e,s=0;s<i.length;s++){var d,o=l.children,c=i[s];if(s+1<i.length){for(var u=!1,h=0;h<o.length;h++)if(o[h].name==c){d=o[h],u=!0;break}u||(d={name:c,children:[]},o.push(d)),l=d}else d={name:c,size:a},o.push(d)}}return e}var o=$(window).width()/1.5,c=$(window).height()/1.5,u=Math.min(o,c)/2,h={w:75,h:30,s:3,t:10},p=function(){var t=null,e=JSON.stringify({teste:"teste"});return $.ajax({async:!1,timeout:4e3,type:"POST",url:"/generate-colors",data:e,contentType:"application/json; charset=utf-8",success:function(e){t=e}}),t}(),f=0,v=d3.select("#chart").append("svg:svg").attr("width",o).attr("height",c).append("svg:g").attr("id","container").attr("transform","translate("+o/2+","+c/2+")"),y=d3.partition().size([2*Math.PI,u*u]),g=d3.arc().startAngle(function(t){return t.x0}).endAngle(function(t){return t.x1}).innerRadius(function(t){return Math.sqrt(t.y0)}).outerRadius(function(t){return Math.sqrt(t.y1)});d3.text("../politicianAccepted.csv",function(e){t(d(d3.csvParseRows(e)))}),$(window).resize(function(){location.reload()}),d3.select(self.frameElement).style("height","700px")});